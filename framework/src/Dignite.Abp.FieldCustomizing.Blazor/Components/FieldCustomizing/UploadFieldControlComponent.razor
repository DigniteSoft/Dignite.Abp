@using Dignite.Abp.FieldCustomizing.Blazor
@using Dignite.Abp.FieldCustomizing.FieldControls
@using Dignite.Abp.FieldCustomizing.FieldControls.Upload
@using Dignite.Abp.FieldCustomizing
@using Dignite.Abp.FieldCustomizing.Blazor.Components.Shared
@using Microsoft.AspNetCore.Components.Forms
@inherits FieldControlComponentBase

    <Field Horizontal="true">
        <FieldLabel ColumnSize="ColumnSize.Is2">@CustomizeField.Definition.DisplayName</FieldLabel>
        <FieldBody ColumnSize="ColumnSize.Is10">      
            <FileEdit Changed="@OnFileChanged" Multiple="@Configuration.Multiple" Filter="@Configuration.Filter" Placeholder="@Configuration.Placeholder" />
            <FieldHelp>@Configuration.Description</FieldHelp>
        </FieldBody>
    </Field>


@code{
    public override Type FieldControlProviderType => typeof(UploadFieldControlProvider);

    public UploadConfiguration Configuration { get; set; }

    protected override void OnParametersSet()
    {
        Configuration = new UploadConfiguration(CustomizeField.Definition.Configuration);
    }
    

    private Task OnFileChanged( FileChangedEventArgs e )
    {
        if (e.Files.Any())
        {
            List<IFileEntry> files = new List<IFileEntry>();
            foreach (var file in e.Files)
            {
                files.Add(file);
            }
            CustomizeField.Entity.SetField(CustomizeField.Definition.Name, files);
        }
        return Task.CompletedTask;
    }
}